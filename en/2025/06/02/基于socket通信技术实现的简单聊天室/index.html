
  <!DOCTYPE html>
  <html lang="en"  
    
      data-theme-mode="auto"
    
  >
  <head>
  
  <meta charset="utf-8">
  

  

  

  <script>window.REIMU_CONFIG = {};window.REIMU_CONFIG.clipboard_tips = {"success":{"zh-CN":"å¤åˆ¶æˆåŠŸ (*^â–½^*)","en":"Copy successfully (*^â–½^*)"},"fail":{"zh-CN":"å¤åˆ¶å¤±è´¥ (ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","en":"Copy failed (ï¾ŸâŠ¿ï¾Ÿ)ï¾‚"},"copyright":{"enable":false,"count":50,"license_type":"by-nc-sa"}};window.REIMU_CONFIG.clipboard_tips.copyright.content = 'æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼';window.REIMU_CONFIG.code_block = {"expand":true};window.REIMU_CONFIG.base = 'http://luminous.blog';window.REIMU_CONFIG.i18n_languages = ["en"];</script>
  
  <title>
    java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤ |
    
    Luminous&#39; Tiny Home
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.0.0/css/regular.min.css" integrity="sha384-PmxfVzUpFiyj5ZqzN3upnv7G4x9YAlMQar&#x2F;qCBLEYSaWr&#x2F;DUQ9f&#x2F;8ITCT0aN7byC" crossorigin="anonymous">
<link rel="stylesheet" href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.0.0/css/solid.min.css" integrity="sha384-HMy1VqP4zke4zzaS+hmFgbW3QXDYD+qtueW3unq30MTgdOnarIgANSya8s5qKRh5" crossorigin="anonymous">

    <link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.0.0/css/brands.min.css" integrity="sha384-IzIkDWjFFaoFz413tu2x9R4cMiJ3EGuxOf&#x2F;7Q8X0LFhqz9fU5zT2go7BgenYdKgN" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.0.0/css/v5-font-face.min.css" integrity="sha384-691KBFHHuy2pnDTyR36VZ90jy7dXWBfC5D1nzy5rkDlqQQ&#x2F;vRs&#x2F;nmmK++LBfAp&#x2F;C" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/@fortawesome/fontawesome-free@7.0.0/css/v4-font-face.min.css" integrity="sha384-7c0mz5ReY2wCEDKNNEdrKdbtS&#x2F;6+5dEgNsz&#x2F;dU3e9m7xldAdTFwNTAuX+s4sJHJl" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="ğŸ¥§ä¼ ç»Ÿsocketå®ç°çš„ç§èŠã€ç¾¤èŠã€æ–‡ä»¶å‘é€ç­‰åŠŸèƒ½çš„tinyç‰ˆQQ">
<meta property="og:type" content="article">
<meta property="og:title" content="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
<meta property="og:url" content="http://luminous.blog/en/2025/06/02/%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4/index.html">
<meta property="og:site_name" content="Luminous&#39; Tiny Home">
<meta property="og:description" content="ğŸ¥§ä¼ ç»Ÿsocketå®ç°çš„ç§èŠã€ç¾¤èŠã€æ–‡ä»¶å‘é€ç­‰åŠŸèƒ½çš„tinyç‰ˆQQ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://luminous.blog/images/covers/github-mark.png">
<meta property="og:image" content="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/1.png">
<meta property="og:image" content="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/2.png">
<meta property="og:image" content="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/3.png">
<meta property="article:published_time" content="2025-06-02T10:19:03.000Z">
<meta property="article:modified_time" content="2025-06-02T14:00:00.000Z">
<meta property="article:author" content="Luminous">
<meta property="article:tag" content="java">
<meta property="article:tag" content="socket">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://luminous.blog/images/covers/github-mark.png">
  
  
    <link rel="alternate" href="/atom.xml" title="Luminous' Tiny Home" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" integrity="sha384-IfxC36XL&#x2F;toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx&#x2F;1oA&#x2F;0l8ysE" crossorigin="anonymous">
  
  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@waline/client@2.15.8/dist/waline.css" integrity="sha384-vltfZtesCdl6NYVcFVcjEaIi5RpNvZe9t7fXvq8twVtcoy+Ub9QgnxUYJmwOhYCK" crossorigin="anonymous">

    
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css" integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin="anonymous">

  
  
    <link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" integrity="sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj+vDDLIL+xBGQU&#x2F;voDBY5XE2lVh" crossorigin="anonymous">
  
  
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate">
        
          <img src="/images/favicon.ico" alt="loading" />
        
      </div>
      
      
        
      
      <div class="loading-word">Loading...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var loaderEl = document.getElementById('loader');
    var startLoading = () => {
      time = Date.now();
      loaderEl.classList.remove("loading");
    }
    var hideLoader = () => {
      document.body.style.overflow = 'auto';
      loader.classList.add('loading');
    };

    var endLoading = () => {
      if (!time) {
        hideLoader();
      } else {
        if (Date.now() - time > 500) {
          time = null;
          hideLoader();
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    loaderEl.addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip"></div>
<div id="heatmap-tooltip"></div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav" aria-label="Primary navigation">
    
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon ">
             
              
                &#xf015;
              
             
          </div>
          <a class="main-nav-link" href="/en/">Home</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon ">
             
              
                &#xf187;
              
             
          </div>
          <a class="main-nav-link" href="/en/archives">Archives</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon ">
             
              
                &#xf007;
              
             
          </div>
          <a class="main-nav-link" href="/en/about">About</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon ">
             
              
                &#xf2b5;
              
             
          </div>
          <a class="main-nav-link" href="/en/friend">Friend</a>
        </span>
      
    
    <a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a>
  </nav>
  <nav id="sub-nav" aria-label="Secondary navigation">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed" aria-label="RSS Feed" target="_blank"></a>
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search" aria-label="Search"></a>
    
  </nav>
  
    
    <nav id="i18n-nav" aria-label="Language selection">
      <div class="custom-dropdown">
        <div class="select-selected" id="select-selected" role="button" aria-haspopup="listbox" aria-expanded="false" aria-label="Language menu">
          <span id="nav-language-btn" class="nav-icon" style="padding: 0 20px 0 0"></span>
          <span id="selected-lang">English</span>
        </div>
        <ul class="select-items" id="select-items" role="listbox" aria-label="Languages">
          
            <li data-value="zh-CN" role="option" aria-selected="false">ç®€ä½“ä¸­æ–‡</li>
          
            <li data-value="en" role="option" class="selected" aria-selected="true">English</li>
          
        </ul>
      </div>
      <script>
        var selectSelected = document.getElementById("select-selected");
        var selectedLang = document.getElementById("selected-lang");
        var selectItems = document.getElementById("select-items");
        var selectOptions = selectItems.querySelectorAll("li");

        selectSelected.addEventListener("click", () => {
          selectItems.classList.toggle("show");
          var expanded = selectSelected.getAttribute("aria-expanded") === "true";
          selectSelected.setAttribute("aria-expanded", (!expanded).toString());
        });

        selectOptions.forEach((item) => {
          item.addEventListener("click", () => {
            const langMap = {};
            
              langMap['zh-CN'] = '/2025/06/02/åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤/';
            
              langMap['en'] = '/en/2025/06/02/åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤/';
            
            selectedLang.textContent = item.textContent;
            selectItems.classList.remove("show");
            selectOptions.forEach((option) => {
              option.classList.remove("selected");
            });
            item.classList.add("selected");
            window.location = langMap[item.dataset.value];
          });
        });

        document.addEventListener("click", (event) => {
          if (!event.target.closest(".custom-dropdown")) {
            selectItems.classList.remove("show");
            selectSelected.setAttribute("aria-expanded", "false");
          }
        });
      </script>
    </nav>
  
</div>
<header id="header" aria-label="Site header">
  
    <picture></picture>
    <img  fetchpriority="high" src="http://luminous.blog/covers/cover12.webp" alt="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <span id="logo">
            <h1 data-aos="slide-up">java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤</h1>
          </span>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content" aria-label="Page content" class="sidebar-left"  >
          <aside id="sidebar" aria-label="Sidebar">
  
  <div class="sidebar-wrapper-container sticky">
  
    
    
      <meting-js
        theme="var(--color-link)"
        id="13796951407"
        server="netease"
        type="playlist"
        
        
        
        
        
        preload="true"
        
        
        list-folded="true"
        
      ></meting-js>
    
  
 
  <div class="sidebar-wrapper">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        
          <div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class" >
  
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4"><span class="toc-number">1.</span> <span class="toc-text">[java]åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">å¼•è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socket%E6%A0%B8%E5%BF%83java%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">socketæ ¸å¿ƒjavaç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK%E4%B8%8B%E8%BD%BD%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">é¡¹ç›®ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">å¼€å§‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chatcommon"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">chatcommon</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chatmain-chatframe"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">chatmain&#x2F;chatframe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resources"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">resources</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">service</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%8E%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.1.</span> <span class="toc-text">æ³¨å†Œä¸ç™»å½•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%81%E8%81%8A%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.2.</span> <span class="toc-text">ç§èŠåŠŸèƒ½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.3.</span> <span class="toc-text">å…¶ä»–åŠŸèƒ½</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
  
</div>
</div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Luminous" class="lazyload">
  <div class="sidebar-author-name">Luminous</div>
  <div class="sidebar-description">åŠ¨æ¼«å®…&amp;æŠ€æœ¯å®…</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Post</div>
    <div class="sidebar-state-number">13</div>
  </div>
  <div class="sidebar-state-category">
    <div>Category</div>
    <div class="sidebar-state-number">8</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tag</div>
    <div class="sidebar-state-number">9</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Torchman005 itemprop="url" target="_blank" aria-label="github" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-youtube sidebar-social-icon">
      <a href=https://www.youtube.com/@LuminousZJ itemprop="url" target="_blank" aria-label="youtube" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/356164519?spm_id_from=333.1007.0.0 itemprop="url" target="_blank" aria-label="bilibili" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-stackoverflow sidebar-social-icon">
      <a href=https://stackoverflow.com/users/30805314/luminous itemprop="url" target="_blank" aria-label="stackoverflow" rel="noopener nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/" aria-label="Home"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf015;
            
          
        </div>
        <div class="sidebar-menu-link">Home</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/archives" aria-label="Archives"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf187;
            
          
        </div>
        <div class="sidebar-menu-link">Archives</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/about" aria-label="About"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf007;
            
          
        </div>
        <div class="sidebar-menu-link">About</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/friend" aria-label="Friend"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf2b5;
            
          
        </div>
        <div class="sidebar-menu-link">Friend</div>
      </div>
    
  
</div>
</div>
        
      
      
        
          <div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div>
        
      
    </div>
  </div>
  
  <div class="sidebar-widget">
  
  </div>
  
  </div>
  
</aside>

          <section id="main" aria-label="Main content"><article id="post-åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤" class="h-entry article" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <span class="article-date-link icon-calendar" data-aos="zoom-in">
    <time datetime="2025-06-02T10:19:03.000Z" itemprop="datePublished">2025-06-02</time>
    <time style="display: none;" id="post-update-time">2025-06-02</time>
  </span>
  
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/en/categories/java/" title="java">java</a>
  </div>


    </div>
    
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="java-åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤"><a href="#java-åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤" class="headerlink" title="[java]åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤"></a>[java]åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤</h1><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>socketï¼Œä½ ä¹Ÿè®¸æ²¡å¬è¯´è¿‡ï¼Œä½†ä½ ä¸å¯èƒ½æ²¡ç”¨åˆ°è¿‡(<del>é™¤éä½ 21ä¸–çºªä»¥æ¥æ²¡æœ‰æ¥è§¦è¿‡ç”µå­äº§å“</del>)ã€‚å¸¸è§å¦‚QQï¼Œå¾®ä¿¡ï¼Œåªè¦å­˜åœ¨èŠå¤©æ¡†å’Œè¯„è®ºçš„åœ°æ–¹ï¼Œsocketéƒ½å‘æŒ¥ç€å®ƒçš„ä½œç”¨ã€‚æœ¬æ–‡ç« å°†ä¼šåˆ†<strong>ä¸‰å¤§æ¨¡å—</strong>(socketåç«¯ç¼–ç¨‹ï¼Œæ•°æ®åº“ï¼ŒUIç¼–ç¨‹)ï¼Œå¸¦ä½ DIYä¸€ä¸ªå±äºè‡ªå·±çš„<strong>èŠå¤©å®¤</strong>ã€‚</p>
<p>æœ¬é¡¹ç›®å·²åœ¨GitHubå¼€æº:</p>
<div class="post-link-card-wrap">
    <div class="post-link-card">
      <a href="https://github.com/Torchman005/Simple-Chat-Room" title="Simple-Chat-Room" rel="noopener nofollow noreferrer" target="_blank"></a>
      <div class="post-link-card-cover-wrap"><img src="http://luminous.blog/images/covers/github-mark.png" class="no-lightbox" title="Simple-Chat-Room" alt="Simple-Chat-Room"/></div>
      <div class="post-link-card-item-wrap">
        <div class="post-link-card-title">Simple-Chat-Room</div>
        <div class="post-link-card-excerpt"><span class="icon-link"></span>https://github.com/Torchman005/Simple-Chat-Room</div>
      </div>
    </div>
  </div>


<blockquote>
<p>socketæ ¸å¿ƒæ¨¡å—ï¼šäº†è§£å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¿¡æ¯ä¼ é€’çš„åŸç†ï¼Œæ‰‹åˆƒå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯</p>
<p>æ•°æ®åº“æ¨¡å—ï¼šå­¦ä¹ å¦‚ä½•ä¿å­˜ç”¨æˆ·ä¿¡æ¯ã€ç¾¤èŠä¿¡æ¯ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–</p>
<p>UIæ¨¡å—ï¼šä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ˜“äºæ“ä½œçš„çª—å£ï¼Œç¾åŒ–èŠå¤©å®¤ï¼Œé™ä½ä½¿ç”¨é—¨æ§›</p>
</blockquote>
<p>æœ¬é¡¹ç›®éœ€è¦çš„å·¥å…·ï¼šjdk17(æœ¬äººä½¿ç”¨)ï¼ŒIDEAï¼Œmaven(IDEAæœ‰è‡ªå¸¦çš„)ï¼ŒNavicatï¼Œmysqlï¼ŒjavaFXç›¸å…³ä¾èµ–ï¼ŒJDBCç›¸å…³ä¾èµ–ï¼Œæœ€ä½2C2Gäº‘æœåŠ¡å™¨ï¼ŒXterminal(åªè¦èƒ½è¿æ¥æœåŠ¡å™¨å°±è¡Œ)ï¼Œ<del>ä¸€ä¸ªä¼šæ€è€ƒçš„å¤§è„‘</del></p>
<p>éœ€è¦ä¼šçš„ä¸œè¥¿ï¼šJavaSEåŸºç¡€ï¼Œsqlè¯­å¥ï¼Œæ•°æ®åº“æ“ä½œï¼Œmavenä¾èµ–ç®¡ç†ï¼ŒLinuxåŸºæœ¬å‘½ä»¤ï¼Œdockeræ“ä½œ(ä¸ä½œç¡¬æ€§è¦æ±‚)</p>
<hr>
<h2 id="socketæ ¸å¿ƒjavaç¼–ç¨‹"><a href="#socketæ ¸å¿ƒjavaç¼–ç¨‹" class="headerlink" title="socketæ ¸å¿ƒjavaç¼–ç¨‹"></a>socketæ ¸å¿ƒjavaç¼–ç¨‹</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p><strong>socket</strong>ç¼–ç¨‹å±äºç½‘ç»œç¼–ç¨‹çš„ä¸€ç§ç»å…¸æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡socketå…³é”®å­—å®ç°ç½‘ç»œä¸Šçš„é€šä¿¡ã€‚socket(æ’åº§)ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæŠ½è±¡çš„ç†è§£ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ä¸€ä¸ªsocketæ’åº§ï¼Œé€šè¿‡ç½‘ç»œå°†è¿™ä¸¤ä¸ªæ’åº§è¿æ¥æ¥å®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯ã€å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¿¡æ¯çš„ä¼ é€’ã€‚</p>
<blockquote>
<p>ä¸€èˆ¬çš„å¤§å‹é¡¹ç›®ä¼šä½¿ç”¨<strong>WebSocket</strong>æŠ€æœ¯ä»¥åŠ<strong>Netty</strong>+<strong>SpringBoot</strong>æ¥æ”¯æŒå¤§ç”¨æˆ·é‡çš„æœåŠ¡ï¼Œä½†æœ¬æ–‡ä»…æä¾›äº†èŠå¤©å®¤çš„å…¥é—¨å°é¡¹ç›®æ•™ç¨‹ï¼Œé‚é‡‡ç”¨ä¼ ç»Ÿ<strong>socket</strong>å®ç°èŠå¤©åŠŸèƒ½</p>
</blockquote>
<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><h4 id="JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®"><a href="#JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®"></a>JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®</h4><p>é‰´äºæ¬²ç¼–å†™æœ¬é¡¹ç›®çš„äººåº”åŸºæœ¬æŒæ¡<strong>Java</strong>åŸºç¡€ï¼Œè¿™é‡Œæˆ‘ä¼šä¸€ç¬”å¸¦è¿‡</p>
<p>å› ä¸ºæœ¬é¡¹ç›®æ˜¯åŸºäºjavaè¯­è¨€ç¼–ç¨‹ï¼Œæ‰€ä»¥éœ€è¦ä»Javaå®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<strong>JDK</strong></p>
<p><em><strong>Java</strong>å®˜ç½‘</em>ï¼š<a target="_blank" rel="noopener" href="https://www.java.com/zh-CN/">https://www.java.com/zh-CN/</a></p>
<p>ä¸‹è½½å®‰è£…åŒ…ååŒå‡»å®‰è£…ç¨‹åºï¼Œé€‰æ‹©å®‰è£…è·¯å¾„(å¯ä»¥ä¿æŒé»˜è®¤)ï¼Œç„¶åä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥ï¼Œé€‰é¡¹éƒ½ä¿æŒé»˜è®¤ï¼Œç›´è‡³å®‰è£…å®Œæˆ</p>
<p>å®‰è£…å®Œæˆä»¥ååœ¨é«˜çº§ç³»ç»Ÿè®¾ç½®ä¸­æ·»åŠ <strong>Path</strong></p>
<blockquote>
<p>å¦‚æœè¿™äº›ä¸œè¥¿è¿˜éœ€è¦æˆ‘è¯¦ç»†è¯´çš„è¯ï¼Œå»ºè®®å…ˆä»JavaåŸºç¡€å¼€å§‹å­¦èµ·â†’_â†’</p>
</blockquote>
<h3 id="é¡¹ç›®ç¼–ç¨‹"><a href="#é¡¹ç›®ç¼–ç¨‹" class="headerlink" title="é¡¹ç›®ç¼–ç¨‹"></a>é¡¹ç›®ç¼–ç¨‹</h3><h4 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h4><p>é¦–å…ˆæˆ‘ä»¬è¦åœ¨<strong>IDEA</strong>ä¸­æ–°å»º<strong>maven</strong>é¡¹ç›®ï¼Œç„¶ååœ¨<strong>main</strong>ç›®å½•ä¸‹åˆ›å»ºåŒ…ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ–‡ä»¶çš„ç›®å½•ç»“æ„</p>
<p><img src="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/1.png" alt="å®¢æˆ·ç«¯"><img src="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/2.png" alt="æœåŠ¡ç«¯"></p>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p><strong>cfg</strong>å­˜æ”¾é…ç½®æ–‡ä»¶</p>
<p><strong>service</strong>å­˜æ”¾ä¸€äº›èŠå¤©åŠŸèƒ½å¦‚ç§èŠã€ç¾¤èŠçš„å®ç°ç±»</p>
<p><strong>chatcommon</strong>å­˜æ”¾Userç”¨æˆ·ç±»å’ŒMessageä¿¡æ¯ç±»ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯éœ€ä¿æŒä¸€è‡´</p>
<p><strong>utils</strong>ä¸ºå·¥å…·åŒ…ï¼Œå­˜æ”¾è‡ªå·±å†™çš„æ–¹ä¾¿ç¼–ç¨‹çš„å·¥å…·ç±»</p>
<p><strong>main</strong>å’Œ<strong>chatframe</strong>åˆ†åˆ«ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¯åŠ¨ç±»</p>
</blockquote>
<h4 id="chatcommon"><a href="#chatcommon" class="headerlink" title="chatcommon"></a>chatcommon</h4><p>æˆ‘ä»¬å…ˆä»è¿™ä¸ªåŒ…å…¥æ‰‹ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ä¿¡æ¯ä¼ é€’éƒ½é è¿™ä¸ªåŒ…ä¸­çš„ç±»ï¼Œåªæœ‰å†™å®Œå…¶ä¸­çš„ç±»æ‰èƒ½å®ç°åŒç«¯äº¤äº’</p>
<p><strong>User</strong>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.chatcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">//    æŒ‡å®šåºåˆ—åŒ–ç‰ˆæœ¬å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String userId; <span class="comment">// ç”¨æˆ·Idå±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String pwd; <span class="comment">// å¯†ç å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String userType; <span class="comment">// ç”¨æˆ·ä¿¡æ¯ç±»å‹(åˆ¤æ–­ç”¨æˆ·æ˜¯ç™»å½•è¿˜æ˜¯æ³¨å†Œ)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserType</span><span class="params">(String userType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userType = userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String userId, String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userId=&#x27;&quot;</span> + userId + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pwd=&#x27;&quot;</span> + pwd + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPwd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPwd</span><span class="params">(String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å£°æ˜äº†ç”¨æˆ·çš„<strong>userId</strong>ã€<strong>pwd</strong>ï¼Œæ·»åŠ äº†æ„é€ æ–¹æ³•å’Œ<strong>getter</strong>,<strong>setter</strong>æ–¹æ³•ï¼Œå¹¶é‡å†™äº†<strong>toString</strong>æ–¹æ³•</p>
<p><strong>UserType</strong>æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.chatcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserType</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">USER_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>; <span class="comment">// ç”¨æˆ·ç™»å½•</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">USER_REGISTER</span> <span class="operator">=</span> <span class="string">&quot;2&quot;</span>; <span class="comment">// ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¥å£ç”¨æ¥è®¾å®šå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„ç”¨æˆ·ä¿¡æ¯ç±»å‹ï¼Œåˆ¤æ–­æ˜¯è¦ç™»å½•è¿˜æ˜¯è¦æ³¨å†Œ</p>
<p><strong>Message</strong>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.chatcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.PrimitiveIterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šåºåˆ—åŒ–ç‰ˆæœ¬å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String sender; <span class="comment">// å‘é€è€…Id</span></span><br><span class="line">    <span class="keyword">private</span> String getter; <span class="comment">// æ¥æ”¶è€…Id</span></span><br><span class="line">    <span class="keyword">private</span> String content;<span class="comment">// å‘é€å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> String sendTime; <span class="comment">// å‘é€æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String mesType;<span class="comment">// æ¶ˆæ¯ç±»å‹ï¼ˆæ¥å£å®šä¹‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å’Œæ–‡ä»¶ç›¸å…³çš„å­—æ®µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] fileBytes; <span class="comment">// ç”¨æ¥è¯»å–æ–‡ä»¶çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">fileLen</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> String dest;<span class="comment">// æ–‡ä»¶ä¼ è¾“åˆ°å“ªé‡Œ</span></span><br><span class="line">    <span class="keyword">private</span> String src;<span class="comment">// æ–‡ä»¶æºè·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; groupMembers; <span class="comment">// ç¾¤ç»„ç”¨æˆ·é˜Ÿåˆ—ï¼Œä¸´æ—¶å­˜å‚¨ç¾¤èŠæˆå‘˜</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; onlineUsers; <span class="comment">// åœ¨çº¿ç”¨æˆ·é˜Ÿåˆ—ï¼Œä¸´æ—¶å­˜å‚¨åœ¨çº¿ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isUser; <span class="comment">// åˆ¤æ–­æœ‰æ— æ­¤ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isGroup; <span class="comment">// åˆ¤æ–­æœ‰æ— æ­¤ç¾¤èŠ</span></span><br><span class="line">    <span class="keyword">private</span> String groupName; <span class="comment">// ç¾¤èŠåç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String mesType, String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mesType = mesType;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">        <span class="built_in">this</span>.sendTime = <span class="keyword">new</span> <span class="title class_">java</span>.util.Date().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String mesType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mesType = mesType;</span><br><span class="line">        <span class="built_in">this</span>.sendTime = <span class="keyword">new</span> <span class="title class_">java</span>.util.Date().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isUser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(<span class="type">boolean</span> user)</span> &#123;</span><br><span class="line">        isUser = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isGroup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isGroup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroup</span><span class="params">(<span class="type">boolean</span> group)</span> &#123;</span><br><span class="line">        isGroup = group;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Queue&lt;String&gt; <span class="title function_">getOnlineUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> onlineUsers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnlineUsers</span><span class="params">(Queue&lt;String&gt; onlineUsers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.onlineUsers = onlineUsers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Queue&lt;String&gt; <span class="title function_">getGroupMembers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> groupMembers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroupMembers</span><span class="params">(Queue&lt;String&gt; groupMembers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.groupMembers = groupMembers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGroupName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> groupName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGroupName</span><span class="params">(String groupName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.groupName = groupName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] getFileBytes() &#123;</span><br><span class="line">        <span class="keyword">return</span> fileBytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileBytes</span><span class="params">(<span class="type">byte</span>[] fileBytes)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileBytes = fileBytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFileLen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fileLen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileLen</span><span class="params">(<span class="type">int</span> fileLen)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fileLen = fileLen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDest</span><span class="params">(String dest)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dest = dest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSrc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSrc</span><span class="params">(String src)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.src = src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSender</span><span class="params">(String sender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sender = sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGetter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGetter</span><span class="params">(String getter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.getter = getter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSendTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sendTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSendTime</span><span class="params">(String sendTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sendTime = sendTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMesType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mesType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMesType</span><span class="params">(String mesType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mesType = mesType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>Message</strong>æ¥å£(ä¸»è¦è®¾ç½®æ¶ˆæ¯ç±»å‹)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.chatcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageType</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_LOGIN_SUCCEED</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;<span class="comment">//ç™»å½•æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_LOGIN_FAIL</span> <span class="operator">=</span> <span class="string">&quot;2&quot;</span>;<span class="comment">//ç™»å½•å¤±è´¥çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_COMM_MES</span> <span class="operator">=</span> <span class="string">&quot;3&quot;</span>;<span class="comment">//Messageå’ŒUserå¯¹è±¡æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_REQ_ONLINE_USERS</span> <span class="operator">=</span> <span class="string">&quot;4&quot;</span>;<span class="comment">//è¯·æ±‚è¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_RET_ONLINE_USERS_LIST</span> <span class="operator">=</span> <span class="string">&quot;5&quot;</span>;<span class="comment">//è¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_CLIENT_EXIT</span> <span class="operator">=</span> <span class="string">&quot;6&quot;</span>;<span class="comment">//ç”¨æˆ·é€€å‡º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_TO_GROUP_MES</span> <span class="operator">=</span> <span class="string">&quot;7&quot;</span>;<span class="comment">//ç¾¤å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_FILE_MES</span> <span class="operator">=</span> <span class="string">&quot;8&quot;</span>;<span class="comment">//æ–‡ä»¶å‘é€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_PULL_GROUP_MES</span> <span class="operator">=</span> <span class="string">&quot;9&quot;</span>;<span class="comment">//æ‹‰ç¾¤</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_SEND_TO_ALL</span> <span class="operator">=</span> <span class="string">&quot;10&quot;</span>;<span class="comment">//æœåŠ¡ç«¯æ¨é€æ–°é—»</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_SYSTEM</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;<span class="comment">//ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_REGISTER</span> <span class="operator">=</span> <span class="string">&quot;12&quot;</span>;<span class="comment">//æ³¨å†Œ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_REGISTER_SUCCEED</span> <span class="operator">=</span> <span class="string">&quot;12&quot;</span>;<span class="comment">//æ³¨å†ŒæˆåŠŸ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">MESSAGE_REGISTER_FAIL</span> <span class="operator">=</span> <span class="string">&quot;13&quot;</span>;<span class="comment">//æ³¨å†Œå¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è®¾ç½®æ¶ˆæ¯ç±»å‹(<strong>MessageType</strong>)æ¥è®©æœåŠ¡ç«¯è¯†åˆ«ä¸åŒçš„åŠŸèƒ½è¯·æ±‚ï¼Œä»è€Œå®ç°ä¸åŒçš„åŠŸèƒ½</p>
<h4 id="chatmain-chatframe"><a href="#chatmain-chatframe" class="headerlink" title="chatmain&#x2F;chatframe"></a>chatmain&#x2F;chatframe</h4><p>è¿™ä¸¤ä¸ªåŒ…ä¸‹éƒ½åˆ†åˆ«åªæœ‰ä¸€ä¸ªç±»ï¼Œé‚£å°±æ˜¯ç¨‹åºçš„å¯åŠ¨å…¥å£(ä¸»ç±»)</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.main;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jinyu.ui.LoginUI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javafx.application.Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®ç³»ç»Ÿå±æ€§ï¼Œè§£å†³ä¸­æ–‡ä¹±ç </span></span><br><span class="line">        System.setProperty(<span class="string">&quot;file.encoding&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯åŠ¨JavaFXåº”ç”¨</span></span><br><span class="line">        Application.launch(LoginUI.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª<strong>main</strong>æ–¹æ³•å¯åŠ¨çš„æ˜¯UIç•Œé¢ï¼ŒUIçš„é€»è¾‘å…¨éƒ¨å†™åœ¨<strong>ui</strong>è¿™ä¸ªåŒ…ä¸‹</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jinyu.chatframe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jinyu.chatserver.service.ChatServer;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatFrame</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ChatServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡newä¸ª<strong>ChatServer</strong>å¯¹è±¡æ¥å¯åŠ¨æœåŠ¡ç«¯</p>
<h4 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h4><p>resourcesä¸­ä¸“é—¨å­˜æ”¾é¡¹ç›®çš„å„ç§é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¦å†™çš„é…ç½®æ–‡ä»¶ååˆ†ç®€å•</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶æˆ‘å‘½åä¸ºconfig.propertiesï¼Œæ‰€ä»¥ä¸‹æ–‡ä¼šç”¨configæŒ‡ä»£è¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="attr">host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">2323</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé…ç½®äº†è¦è¿æ¥çš„æœåŠ¡å™¨çš„ipå’Œç«¯å£</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span>=<span class="string">2323</span></span><br></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><h5 id="æ³¨å†Œä¸ç™»å½•åŠŸèƒ½"><a href="#æ³¨å†Œä¸ç™»å½•åŠŸèƒ½" class="headerlink" title="æ³¨å†Œä¸ç™»å½•åŠŸèƒ½"></a>æ³¨å†Œä¸ç™»å½•åŠŸèƒ½</h5><p><em><strong>å‰è¨€</strong></em></p>
<p>æ— è®ºæ˜¯æ³¨å†Œè¿˜æ˜¯ç™»å½•ï¼Œéƒ½éœ€è¦ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè€Œç”¨æˆ·çš„ä¿¡æ¯éœ€è¦ç”¨æˆ·è‡ªå·±åœ¨UIç•Œé¢ç»™çš„è¾“å…¥æ¡†ä¸­è¾“å…¥å›è½¦æ‰ä¼šè¯»å–ï¼Œæ‰€ä»¥åœ¨<strong>LoginUI</strong>å’Œ<strong>RegisterUI</strong>ç±»ä¸­ï¼Œæˆ‘ä¼šè¯»å–è¾“å…¥æ¡†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œç´§æ¥ç€è°ƒç”¨<strong>ToUserFunction</strong>ä¸­çš„æ³¨å†Œå’Œç™»å½•æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°</p>
<blockquote>
<p>å…³äºUIæ–¹é¢éƒ½ä¼šåœ¨ç¬¬ä¸‰æ¨¡å—ä¸­è§£é‡Šï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸ä½œä»£ç æ¼”ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹serviceä¸­çš„é€»è¾‘&lt;(ï¿£ï¸¶ï¿£)â†—[GO!]</p>
</blockquote>
<p><img src="http://luminous.blog/images/posts/socket%E9%A1%B9%E7%9B%AE/3.png" alt="ToUserFunctionç±»"></p>
<p><em><strong>æ³¨å†Œ</strong></em></p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸ç®¡ä½ ç”¨å“ªä¸ªåº”ç”¨æˆ–ä¸Šå“ªä¸ªç½‘ç«™ï¼Œç”¨æˆ·éƒ½å¾—å…ˆæ³¨å†Œè´¦å·ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“æ‰èƒ½å¤Ÿä½¿ç”¨åŸæœ‰è´¦å·å¯†ç ç™»å½•ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå…ˆä»‹ç»æ³¨å†Œçš„é€»è¾‘åŠå®ç°</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ToUserFunctionç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">registerUser</span><span class="params">(String userId, String pwd)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ToUserFunction.class.getClassLoader();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> classLoader.getResourceAsStream(<span class="string">&quot;config.properties&quot;</span>);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.load(input);</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;host&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sport</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;port&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(sport);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºsocketè¿æ¥</span></span><br><span class="line">        socket = <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getByName(host), port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘æœåŠ¡ç«¯ä¼ è¾“ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        user.setUserId(userId);</span><br><span class="line">        user.setPwd(pwd);</span><br><span class="line">        user.setUserType(UserType.USER_REGISTER);</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        oos.writeObject(user); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥æ”¶æœåŠ¡ç«¯å›å¤çš„æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">        <span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message)ois.readObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ³¨å†Œæ˜¯å¦æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_REGISTER_SUCCEED)) &#123;</span><br><span class="line">            b = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ³¨å†Œå¤±è´¥(ç”¨æˆ·åå·²å­˜åœ¨)&quot;</span>));</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ³¨å†Œå¤±è´¥: &quot;</span> + e.getMessage()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªæ˜¯ç”¨æˆ·åœ¨å®¢æˆ·ç«¯çš„æ³¨å†Œå®ç°ï¼Œæˆ‘ä»¬æ¥å‰–æä¸€ä¸‹</p>
</blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®©å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼Œå°±éœ€è¦ç”¨åˆ°socket</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getByName(host), port);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª<strong>socket</strong>å¯¹è±¡ï¼Œå…¶ä¸­çš„å‚æ•°åˆ†åˆ«æ˜¯ä½ è¦è¿æ¥çš„æœåŠ¡å™¨çš„<strong>InetAddress</strong>å¯¹è±¡å’Œæ‰€åœ¨ç«¯å£å·(è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œ<strong>InetAddress</strong>ç±»ä¸­çš„<strong>getByName</strong>æ–¹æ³•æ˜¯åˆ©ç”¨ä¸»æœºçš„IPåœ°å€æ¥è¿”å›<strong>InetAddress</strong>å¯¹è±¡çš„)ï¼Œæ‰€ä»¥è¦è¯»å–<strong>resources</strong>ä¸­çš„é…ç½®æ–‡ä»¶(<strong>config</strong>)</p>
<p>æ­¤æ—¶æœåŠ¡ç«¯éœ€è¦ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯<strong>socket</strong>çš„åŠ¨ä½œï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´æ‰èƒ½å»ºç«‹è¿æ¥ï¼Œäºæ˜¯åœ¨<strong>æœåŠ¡ç«¯</strong>å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChatServerç±»</span></span><br><span class="line"><span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ChatServer</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//             å¯åŠ¨æ¨é€æ–°é—»çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">SendNewsToAllService</span>()).start();</span><br><span class="line">        <span class="comment">//            è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ChatServer.class.getClassLoader();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> classLoader.getResourceAsStream(<span class="string">&quot;config.properties&quot;</span>);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.load(input);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sport</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;port&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(sport);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡ç«¯åœ¨&quot;</span> + port + <span class="string">&quot;ç«¯å£ç›‘å¬&quot;</span>);</span><br><span class="line">        ss = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();<span class="comment">// ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè‹¥æ²¡æœ‰åˆ™é˜»å¡</span></span><br><span class="line">            <span class="comment">//                å¯¹è±¡è¾“å…¥è¾“å‡ºæµè¯»å–ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) ois.readObject();</span><br><span class="line">            <span class="comment">//                å‡†å¤‡ä¸€ä¸ªMessageå¯¹è±¡ï¼Œç”¨æ¥å›å¤å®¢æˆ·ç«¯</span></span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            ss.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ•´ä¸ªä»£ç éƒ½æ˜¯åœ¨<strong>ChatServer</strong>è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œçš„ï¼Œä¿è¯æœåŠ¡ç«¯å¯åŠ¨åè¿™äº›ä»£ç ä¼šç«‹å³æ‰§è¡Œ</p>
<p>å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯é¦–å…ˆä¹Ÿæ˜¯è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆ›å»º<strong>ServerSocket</strong>å¯¹è±¡ï¼ŒæŠŠä»é…ç½®æ–‡ä»¶è¯»å–çš„ç«¯å£å·(<strong>port</strong>)ä½œä¸ºå‚æ•°ä¼ å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br></pre></td></tr></table></figure>

<p>ç„¶åè°ƒç”¨<strong>ServerSocke</strong>tçš„<strong>accept</strong>æ–¹æ³•æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šå› ä¸ºå°†ä¼šæœ‰å¤šä¸ªå®¢æˆ·ç«¯ç™»å½•ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åªç›‘å¬ä¸€æ¬¡æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿™æ—¶å°±éœ€è¦åœ¨å¤–é¢åŒ…è£¹ä¸€å±‚<strong>whileå¾ªç¯</strong>æ¥æŒç»­ç›‘å¬</p>
</blockquote>
<p><em><strong>è‡³æ­¤ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´å·²å»ºç«‹è¿æ¥</strong></em></p>
<blockquote>
<p>æœåŠ¡ç«¯å°±å…ˆå‘Šä¸€æ®µè½ï¼Œè®©æˆ‘ä»¬å›åˆ°å®¢æˆ·ç«¯</p>
</blockquote>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ToUserFunctionç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æœåŠ¡ç«¯ä¼ è¾“ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">user.setUserId(userId);</span><br><span class="line">user.setPwd(pwd);</span><br><span class="line">user.setUserType(UserType.USER_REGISTER);</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·çš„æ³¨å†Œï¼Œå°±æ˜¯è¦æŠŠç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ä¼ åˆ°æœåŠ¡ç«¯ï¼Œè®©æœåŠ¡ç«¯å†™å…¥æ•°æ®åº“</p>
<p>è¿™é‡Œçš„ç›®çš„ï¼Œå°±æ˜¯å°è£…å¥½<strong>Userå¯¹è±¡</strong>ï¼Œsetå¥½Userçš„<strong>Id</strong>ï¼Œ<strong>pwd</strong>å’Œ**ä½ æ­¤æ¬¡ä¼ è¾“çš„ç”¨æˆ·ä¿¡æ¯ç±»å‹(UserType)**ï¼Œç„¶åé€šè¿‡IOæµä¼ ç»™æœåŠ¡ç«¯</p>
<p>ä¸‹é¢ï¼Œæ˜¯åˆ›å»º<strong>ObjectInputStream</strong>å’Œ<strong>ObjectOutputStream</strong>æ¥è¯»å†™<strong>Userå¯¹è±¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ToUserFunctionç±»</span></span><br><span class="line"></span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">oos.writeObject(user); </span><br><span class="line"><span class="comment">// æ¥æ”¶æœåŠ¡ç«¯å›å¤çš„æ³¨å†Œä¿¡æ¯</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line"><span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message)ois.readObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ³¨å†Œæ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_REGISTER_SUCCEED)) &#123;</span><br><span class="line">    b = <span class="literal">true</span>; <span class="comment">// åˆ¤å®šä¸ºæˆåŠŸï¼Œè¿”å›true</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ³¨å†Œå¤±è´¥(ç”¨æˆ·åå·²å­˜åœ¨)&quot;</span>));</span><br><span class="line">    socket.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ³¨å†Œå¤±è´¥: &quot;</span> + e.getMessage()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ObjectOutputStream</strong>å†™å…¥æœåŠ¡ç«¯çš„socketåï¼ŒæœåŠ¡ç«¯è¯»å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChatServerç±»</span></span><br><span class="line"></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line"> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) ois.readObject();</span><br><span class="line"><span class="comment">// å‡†å¤‡ä¸ªmessageå¯¹è±¡æ¥æ‰¿è½½ä¿¡æ¯å¹¶å‘é€è‡³å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br></pre></td></tr></table></figure>

<p>è¯»å…¥ä»¥åå°±è¦åˆ¤æ–­è¿™ä¸ªUserçš„ç±»å‹äº†ï¼Œåˆ¤æ–­å®ƒæ˜¯ç™»å½•è¿˜æ˜¯æ³¨å†Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(user.getUserType().equals(UserType.USER_REGISTER))&#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ¶‰åŠæ•°æ®åº“SQLæ“ä½œï¼Œæš‚ä¸ä½œå¤„ç†</span></span><br><span class="line">    <span class="comment">//æ³¨å†ŒæˆåŠŸ</span></span><br><span class="line">    message.setMesType(MessageType.MESSAGE_REGISTER_SUCCEED);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œå¤±è´¥</span></span><br><span class="line">        message.setMesType(MessageType.MESSAGE_REGISTER_FAIL);</span><br><span class="line">    &#125;</span><br><span class="line">    oos.writeObject(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éšåå°†messageä¼ ç»™å®¢æˆ·ç«¯</p>
<p><code>oos.writeObject(message);</code></p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ToUserFunctionç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æœåŠ¡ç«¯å›å¤çš„æ³¨å†Œä¿¡æ¯</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line"><span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message)ois.readObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ³¨å†Œæ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_REGISTER_SUCCEED)) &#123;</span><br><span class="line">    b = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ³¨å†Œå¤±è´¥(ç”¨æˆ·åå·²å­˜åœ¨)&quot;</span>));</span><br><span class="line">    socket.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯æ³¨å†ŒæˆåŠŸä¸å¦çš„ä¿¡æ¯ï¼Œå¹¶å°†ç»“æœè¿”å›</p>
<blockquote>
<p>æ³¨å†Œé€»è¾‘å·²å®Œæˆo(<em>ï¿£ï¸¶ï¿£</em>)o</p>
</blockquote>
<p><em><strong>ç™»å½•</strong></em></p>
<p>å…¶å®ç™»å½•çš„å¤§ä½“é€»è¾‘å’Œæ³¨å†Œå·®ä¸å¤šï¼Œåªä¸è¿‡å¤šäº†éªŒè¯Idã€å¯†ç å’Œåˆ›å»ºç”¨æˆ·çº¿ç¨‹çš„æ­¥éª¤</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ToUserFunctionç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkUser</span><span class="params">(String userId, String pwd)</span>&#123;</span><br><span class="line">    <span class="comment">//        ç»™ç™»å½•çš„ç”¨æˆ·è´¦å·å’Œå¯†ç åˆå§‹åŒ–ï¼Œä¾¿äºåç»­éªŒè¯</span></span><br><span class="line">    user.setUserId(userId);</span><br><span class="line">    user.setPwd(pwd);</span><br><span class="line">    user.setUserType(UserType.USER_LOGIN);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ToUserFunction.class.getClassLoader();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> classLoader.getResourceAsStream(<span class="string">&quot;config.properties&quot;</span>);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.load(input);</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;host&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sport</span> <span class="operator">=</span> prop.getProperty(<span class="string">&quot;port&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(sport);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºsocketè¿æ¥</span></span><br><span class="line">        socket = <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getByName(host), port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//            å‘æœåŠ¡ç«¯ä¼ è¾“ç”¨æˆ·ä¿¡æ¯ï¼Œä¼ çš„æ˜¯å¯¹è±¡</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        oos.writeObject(user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChatServerç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(user.getUserType().equals(UserType.USER_LOGIN))&#123;</span><br><span class="line">    <span class="comment">//                ç„¶åå†éªŒè¯æ˜¯å¦èƒ½å¤ŸæˆåŠŸç™»å½•</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="comment">/*è¿™é‡Œéœ€è¦ä½¿ç”¨SQLè¯­å¥æ£€ç´¢æ•°æ®åº“å¹¶æ¯”å¯¹æ¥åˆ¤æ–­ç”¨æˆ·Idå’Œå¯†ç çš„åˆç†æ€§*/</span>)&#123;</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_LOGIN_SUCCEED);</span><br><span class="line">        <span class="comment">//                    åŠ å…¥çº¿ç¨‹</span></span><br><span class="line">        <span class="type">ServerConnectClientThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerConnectClientThread</span>(socket, user.getUserId());</span><br><span class="line">        thread.start();</span><br><span class="line">        ClientThreadsManage.addServerConnectClientThread(user.getUserId(), thread);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//                    å°†ç”¨æˆ·IdåŠ å…¥åœ¨çº¿ç”¨æˆ·é˜Ÿåˆ—</span></span><br><span class="line">        OnlineUsers.addOnlineUsers(user.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//                    ç„¶åæŠŠmessageä¼ ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        oos.writeObject(message);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//                    ç™»å½•å¤±è´¥</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·è´¦å·æˆ–å¯†ç ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_LOGIN_FAIL);</span><br><span class="line">        oos.writeObject(message);</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·Idå’Œå¯†ç æ˜¯å¦åŒ¹é…ï¼Œè‹¥åŒ¹é…åˆ™ç™»é™†æˆåŠŸï¼Œç»™<strong>message</strong>è®¾ç½®ç™»é™†æˆåŠŸçš„ç±»å‹ï¼Œå¹¶å¢åŠ å¯¹åº”ç”¨æˆ·çº¿ç¨‹</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//            è¿˜è¦æ¥å—æœåŠ¡ç«¯å›å¤çš„ç™»å½•ä¿¡æ¯</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line"><span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message)ois.readObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">//            åˆ¤æ–­ç™»å½•æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_LOGIN_SUCCEED))&#123;</span><br><span class="line">    b = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//                å› ä¸ºç™»å½•æˆåŠŸï¼Œæ‰€ä»¥æ–°å¢ä¸€ä¸ªé€šä¿¡çº¿ç¨‹</span></span><br><span class="line">    <span class="type">ClientConnectServerThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientConnectServerThread</span>(socket, chatUI);</span><br><span class="line">    <span class="comment">//                å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">    thread.start();</span><br><span class="line">    <span class="comment">//                æŠŠè¿™ä¸ªçº¿ç¨‹å­˜åˆ°mapé›†åˆä¸­ç»Ÿä¸€ç®¡ç†</span></span><br><span class="line">    ClientConnServerThreadsManage.addClientConnectServerThread(userId, thread);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&quot;</span>));</span><br><span class="line">    socket.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;ç™»å½•å¤±è´¥: &quot;</span> + e.getMessage()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å†æ¬¡æ¥æ”¶åˆ°æœåŠ¡ç«¯ä¼ æ¥çš„ä¿¡æ¯ï¼Œç¡®å®šè‡ªå·±æ˜¯ç™»å½•æˆåŠŸè¿˜æ˜¯ç™»å½•å¤±è´¥ï¼Œè‹¥ç™»é™†æˆåŠŸåˆ™æ·»åŠ è‡ªèº«å¯¹åº”çº¿ç¨‹</p>
<blockquote>
<p>è¿™é‡Œé‡åˆ°äº†ä¸€ä¸ªæ–°çš„å†…å®¹ï¼šçº¿ç¨‹</p>
</blockquote>
<p>è®¤çœŸæ€è€ƒçš„äººå·²ç»æ³¨æ„åˆ°äº†ï¼Œæ—¢ç„¶è¿™é‡Œnewäº†ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ç±»çš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å¦‚ä½ æ‰€è§ï¼Œä¸‹é¢åˆ†åˆ«æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ç±»ï¼š</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientConnectServerThreadç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jinyu.chatclient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jinyu.chatcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.chatcommon.MessageType;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.ui.ChatUI;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.utils.Utility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.ObjectName;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInput;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientConnectServerThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">//    å…¨å±€å˜é‡äº‹å…ˆå£°æ˜</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> ChatUI chatUI;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientConnectServerThread</span><span class="params">(Socket socket,ChatUI chatUI)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        <span class="built_in">this</span>.chatUI = chatUI;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//        whileå¾ªç¯æ¥æŒç»­æ¥æ”¶æœåŠ¡ç«¯ä¼ æ¥çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//            ç­‰å¾…è¯»å–</span></span><br><span class="line">            <span class="comment">//            System.out.println(&quot;(ç­‰å¾…è¯»å–)&quot;);</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">                <span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message) ois.readObject();</span><br><span class="line">                <span class="comment">//            ç­‰å¾…æœåŠ¡ç«¯ä¼ æ¥message</span></span><br><span class="line">                <span class="keyword">if</span> (mes.getMesType().equals(MessageType.MESSAGE_RET_ONLINE_USERS_LIST)) &#123;</span><br><span class="line">                    <span class="comment">//                æœåŠ¡ç«¯çš„ä¿¡æ¯æ˜¯è¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œæ‰€ä»¥è¿™é‡Œç­‰å¾…æ¥æ”¶</span></span><br><span class="line">                    Queue&lt;String&gt; onlineUsers = mes.getOnlineUsers();</span><br><span class="line">                    chatUI.updateOnlineUsers(onlineUsers);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mes.getMesType().equals(MessageType.MESSAGE_COMM_MES)) &#123;</span><br><span class="line">                    <span class="comment">//                æ™®é€šçš„èŠå¤©æ¶ˆæ¯</span></span><br><span class="line">                    chatUI.displayMessage(mes);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_FILE_MES))&#123;</span><br><span class="line">                    chatUI.displayMessage(mes);</span><br><span class="line">                    <span class="comment">// æ–‡ä»¶ä¿å­˜é€»è¾‘å°†åœ¨UIä¸­å¤„ç†</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_SEND_TO_ALL))&#123;</span><br><span class="line">                    <span class="comment">//                    æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯</span></span><br><span class="line">                    chatUI.displayMessage(mes);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_TO_GROUP_MES))&#123;</span><br><span class="line">                    <span class="keyword">if</span>(mes.isGroup())&#123;</span><br><span class="line">                        chatUI.displayMessage(mes);</span><br><span class="line">                    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                        chatUI.displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ— æ­¤ç¾¤èŠï¼ï¹ï¼œ&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    chatUI.displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;å…¶ä»–ç±»å‹çš„ä¿¡æ¯ï¼Œæš‚æ—¶ä¸åšå¤„ç†&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                chatUI.displayMessage(<span class="keyword">new</span> <span class="title class_">Message</span>(MessageType.MESSAGE_SYSTEM, <span class="string">&quot;æ¥æ”¶æ¶ˆæ¯é”™è¯¯: &quot;</span> + e.getMessage()));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Socket <span class="title function_">getSocket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServerConnectClientThreadç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jinyu.chatserver.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jinyu.chatcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.jinyu.chatcommon.MessageType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConnectClientThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServerConnectClientThread</span><span class="params">(Socket socket, String userId)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Socket <span class="title function_">getSocket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(userId + <span class="string">&quot;å·²è¿æ¥å¹¶ä¿æŒé€šä¿¡&quot;</span>);</span><br><span class="line">                <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">                <span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> (Message) ois.readObject();</span><br><span class="line">                <span class="comment">//                è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨å¹¶ä¸”å‘ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_REQ_ONLINE_USERS))&#123;</span><br><span class="line">                    System.out.println(mes.getSender() + <span class="string">&quot;è¯·æ±‚è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨&quot;</span>);</span><br><span class="line">                    Queue&lt;String&gt; onlineUsers = ClientThreadsManage.getOnlineUsers();</span><br><span class="line">                    <span class="type">Message</span> <span class="variable">mes2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">                    mes2.setMesType(MessageType.MESSAGE_RET_ONLINE_USERS_LIST);</span><br><span class="line">                    mes2.setOnlineUsers(onlineUsers);</span><br><span class="line">                    mes2.setGetter(mes.getSender());</span><br><span class="line"></span><br><span class="line">                    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">                    oos.writeObject(mes2);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_CLIENT_EXIT))&#123;</span><br><span class="line">                    <span class="comment">//                    è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">                    ClientThreadsManage.removeSCCThread(mes.getSender());</span><br><span class="line">                    System.out.println(userId + <span class="string">&quot;é€€å‡ºç™»å½•&quot;</span>);</span><br><span class="line">                    OnlineUsers.deleteUser(userId);</span><br><span class="line">                    socket.close(); <span class="comment">// å…³é—­socketè¿æ¥</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_COMM_MES))&#123;</span><br><span class="line">                    <span class="comment">//                    ç§èŠè½¬å‘</span></span><br><span class="line">                    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ClientThreadsManage.getServerConnectClientThread(mes.getGetter()).getSocket().getOutputStream());</span><br><span class="line">                        oos.writeObject(mes);<span class="comment">//è‹¥è¦ç¦»çº¿ç•™è¨€ï¼Œå¯å‘é€ç»™æ•°æ®åº“</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        System.out.println( mes.getGetter() + <span class="string">&quot;ä¸åœ¨çº¿ï¼Œæ— æ³•ç§èŠ&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_FILE_MES))&#123;</span><br><span class="line">                    <span class="comment">//                    æ–‡ä»¶è½¬å‘</span></span><br><span class="line">                    <span class="type">ServerConnectClientThread</span> <span class="variable">thread</span> <span class="operator">=</span> ClientThreadsManage.getServerConnectClientThread(mes.getGetter());</span><br><span class="line">                    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(thread.getSocket().getOutputStream());</span><br><span class="line">                    oos.writeObject(mes);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_PULL_GROUP_MES)) &#123;</span><br><span class="line">                    <span class="comment">//                    æ‹‰ç¾¤ï¼Œå¹¶å°†ç¾¤å­˜å‚¨</span></span><br><span class="line">                    Groups.addGroup(mes.getGroupName(), mes.getGroupMembers());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_TO_GROUP_MES))&#123;</span><br><span class="line">                    <span class="comment">//                    ç¾¤å‘æ¶ˆæ¯</span></span><br><span class="line">                    <span class="comment">//                    åˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç¾¤èŠ</span></span><br><span class="line">                    <span class="keyword">if</span>(Groups.hasGroup(mes.getGroupName()))&#123;</span><br><span class="line">                        mes.setGroup(<span class="literal">true</span>);</span><br><span class="line">                        Queue&lt;String&gt; group = Groups.getGroup(mes.getGroupName());</span><br><span class="line">                        Iterator&lt;String&gt; iterator = group.iterator();</span><br><span class="line">                        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">onlineUser</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                            <span class="keyword">if</span>(!onlineUser.equals(mes.getSender()))&#123;</span><br><span class="line">                                <span class="comment">//                            æ’é™¤å‘æ¶ˆæ¯çš„ç”¨æˆ·</span></span><br><span class="line">                                <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ClientThreadsManage.getServerConnectClientThread(onlineUser).getSocket().getOutputStream());</span><br><span class="line">                                oos.writeObject(mes);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//                        å°†ä¸å­˜åœ¨ç¾¤ç»„çš„ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                        System.out.println(<span class="string">&quot;ä¸å­˜åœ¨æ­¤ç¾¤èŠ&quot;</span>);</span><br><span class="line">                        mes.setGroup(<span class="literal">false</span>);</span><br><span class="line">                        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ClientThreadsManage.getServerConnectClientThread(mes.getSender()).getSocket().getOutputStream());</span><br><span class="line">                        oos.writeObject(mes);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å…¶ä»–ç±»å‹çš„ä¿¡æ¯ï¼Œæš‚æ—¶ä¸ä½œå¤„ç†&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€è¿æ¥çš„æƒ…å†µ</span></span><br><span class="line">                System.out.println(userId + <span class="string">&quot;é€€å‡ºç™»å½•&quot;</span>);</span><br><span class="line">                ClientThreadsManage.removeSCCThread(userId);</span><br><span class="line">                OnlineUsers.deleteUser(userId);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ç±»ä»£ç çœ‹ä¼¼å¾ˆé•¿ï¼Œå…¶å®é€»è¾‘å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯&#x2F;å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œåˆ¤æ–­ä¿¡æ¯çš„ç±»å‹æ¥å®ç°ç›¸åº”çš„<strong>ä»£ç &#x2F;åŠŸèƒ½</strong></p>
<p>åˆ›å»ºè¿™äº›çº¿ç¨‹åï¼Œå¾—éœ€è¦æœ‰ä¸€ä¸ªä¸“é—¨çš„å•ä½å»ç®¡ç†å®ƒä»¬ï¼Œäºæ˜¯å°±å‡ºç°äº†çº¿ç¨‹ç®¡ç†ç±»</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientConnServerThreadManageç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jinyu.chatclient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”¨æ¥ç®¡ç†æ¯ä¸ªç”¨æˆ·çº¿ç¨‹çš„ç±»ï¼ˆç”¨mapé›†åˆå­˜å‚¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientConnServerThreadsManage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, ClientConnectServerThread&gt; hm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//    æ·»åŠ ç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addClientConnectServerThread</span><span class="params">(String userId, ClientConnectServerThread thread)</span> &#123;</span><br><span class="line">        hm.put(userId, thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    æ ¹æ®userIdè·å–ç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ClientConnectServerThread <span class="title function_">getClientConnectServerThread</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hm.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeCCSThread</span><span class="params">(String userId)</span>&#123;</span><br><span class="line">        hm.remove(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientThreadsManageç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jinyu.chatserver.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientThreadsManage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, ServerConnectClientThread&gt; threads = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, ServerConnectClientThread&gt; <span class="title function_">getThreads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threads;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addServerConnectClientThread</span><span class="params">(String userId, ServerConnectClientThread serverConnectClientThread)</span>&#123;</span><br><span class="line"></span><br><span class="line">        threads.put(userId, serverConnectClientThread);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ServerConnectClientThread <span class="title function_">getServerConnectClientThread</span><span class="params">(String userId)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threads.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;String&gt; <span class="title function_">getOnlineUsers</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OnlineUsers.onlineUsers;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeSCCThread</span><span class="params">(String userId)</span>&#123;</span><br><span class="line">        threads.remove(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡åˆ›å»ºçº¿ç¨‹ä¹‹åï¼Œéœ€å°†çº¿ç¨‹çº³å…¥çº¿ç¨‹ç®¡ç†ç±»ï¼Œå°†çº¿ç¨‹éƒ½æ”¾å…¥ä¸€ä¸ªé›†åˆç»Ÿä¸€ç®¡ç†</p>
<blockquote>
<p>äº†è§£å®Œçº¿ç¨‹çš„å¤§ä½“å†…å®¹ä¹‹åï¼Œæˆ‘ä»¬å†å›åˆ°ç™»å½•é€»è¾‘</p>
</blockquote>
<p>æ·»åŠ å¥½å¯¹åº”ç”¨æˆ·çš„çº¿ç¨‹ä¹‹åï¼Œè¿™åç”¨æˆ·ä¾¿æˆä¸ºäº†æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„<strong>åœ¨çº¿ç”¨æˆ·</strong></p>
<p>ç™»å½•å·²å®Œæˆï¼Œçœ‹ä¼¼å¤æ‚ï¼Œå®é™…ä¸Šåªè¦æ‹æ¸…æ¥šæ¯ä¸ªç±»çš„èŒè´£ï¼Œå¹¶ä¸å›°éš¾(<del>è¿«çœŸ</del>)</p>
<h5 id="ç§èŠåŠŸèƒ½"><a href="#ç§èŠåŠŸèƒ½" class="headerlink" title="ç§èŠåŠŸèƒ½"></a>ç§èŠåŠŸèƒ½</h5><blockquote>
<p>å…¶å®æœ¬é¡¹ç›®çš„å¤§ä½“æ¡†æ¶å·²ç»å®Œæˆï¼Œå‰©ä¸‹çš„åŠŸèƒ½å®ç°é€»è¾‘éƒ½å¾ˆç›¸ä¼¼ï¼Œæˆ‘åœ¨è¿™å°±å…ˆå°±ç€ä¸€ä¸ªå…¸å‹ä¾‹å­è¯¦ç»†ä»‹ç»</p>
</blockquote>
<p>å°±æ¯”å¦‚ç§èŠé€»è¾‘ï¼Œä¸€å¼€å§‹å®¢æˆ·ç«¯é€‰æ‹©è¿›è¡Œç§èŠï¼Œå¹¶å°†å‘é€è€…ID(<strong>senderId</strong>)ã€æ¥æ”¶è€…ID(<strong>getterId</strong>)ã€å‘é€çš„å†…å®¹(<strong>content</strong>)ã€æ¶ˆæ¯ç±»å‹(<strong>MessageType</strong>)å°è£…è¿›messageå¯¹è±¡ä¸­å‘é€ç»™æœåŠ¡ç«¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientMessageServiceç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessageToOne</span><span class="params">( String content, String senderId, String getterId)</span>&#123;</span><br><span class="line">    <span class="comment">//        å®ç°ç§èŠ</span></span><br><span class="line">    <span class="comment">//        å°è£…message</span></span><br><span class="line">    <span class="type">Message</span> <span class="variable">mes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">    mes.setMesType(MessageType.MESSAGE_COMM_MES);</span><br><span class="line">    mes.setSender(senderId);</span><br><span class="line">    mes.setContent(content);</span><br><span class="line">    mes.setGetter(getterId);</span><br><span class="line">    mes.setSendTime(<span class="keyword">new</span> <span class="title class_">Date</span>().toString());<span class="comment">//å‘é€æ—¶é—´</span></span><br><span class="line">    System.out.println(<span class="string">&quot;\n&quot;</span> + mes.getSendTime() + <span class="string">&quot;  &quot;</span> + mes.getSender() + <span class="string">&quot;: &quot;</span> + mes.getContent());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ClientConnServerThreadsManage.getClientConnectServerThread(senderId).getSocket().getOutputStream());</span><br><span class="line">        oos.writeObject(mes);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯æ¥æ”¶ä¿¡æ¯çš„ä»£ç å°±ç”±çº¿ç¨‹ç±»æ¥æ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServerConnectClientThreadç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(mes.getMesType().equals(MessageType.MESSAGE_COMM_MES))&#123;</span><br><span class="line">    <span class="comment">//                    ç§èŠè½¬å‘</span></span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ClientThreadsManage.getServerConnectClientThread(mes.getGetter()).getSocket().getOutputStream());</span><br><span class="line">        oos.writeObject(mes);<span class="comment">//è‹¥è¦ç¦»çº¿ç•™è¨€ï¼Œå¯å‘é€ç»™æ•°æ®åº“</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println( mes.getGetter() + <span class="string">&quot;ä¸åœ¨çº¿ï¼Œæ— æ³•ç§èŠ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OKï¼ŒæœåŠ¡ç«¯æ¥æ”¶äº†æ¥è‡ªå®¢æˆ·ç«¯çš„<strong>message</strong>ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åœ¨è¿™é‡Œå°±èµ·åˆ°ä¸€ä¸ªè½¬å‘çš„ä½œç”¨ï¼Œæœ‰äº†getterIdï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»çº¿ç¨‹ç®¡ç†ç±»ä¸­æ‰¾åˆ°è¿™ä¸ªgetterIdå¯¹åº”çš„çº¿ç¨‹ï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥å‡†ç¡®åœ°æŠŠ<strong>message</strong>å‘é€ç»™è¿™ä¸ªå®¢æˆ·ç«¯ï¼Œæ¥æ”¶è€…æ¥æ”¶åˆ°<strong>message</strong>ä»¥åï¼Œå®¢æˆ·ç«¯çº¿ç¨‹å°±ä¼šå†æ¬¡åˆ¤æ–­ä¿¡æ¯çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ç§èŠç±»å‹ï¼Œä¾¿ä¼šè¾“å‡ºç§èŠæ¶ˆæ¯çš„å†…å®¹åˆ°æŒ‡å®šåŒºåŸŸ</p>
<h5 id="å…¶ä»–åŠŸèƒ½"><a href="#å…¶ä»–åŠŸèƒ½" class="headerlink" title="å…¶ä»–åŠŸèƒ½"></a>å…¶ä»–åŠŸèƒ½</h5><blockquote>
<p>ç§èŠåŠŸèƒ½å·²å®Œæˆï¼Œå…¶ä»–åŠŸèƒ½å¤§åŒå°å¼‚ï¼Œæˆ‘ä¸ä¼šå†è¯¦ç»†å‰–æï¼Œæˆ‘ä¼šäº¤ä»£ä¸€äº›ç»†èŠ‚ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•å®ç°</p>
</blockquote>
<p><strong>è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</strong>ï¼šå®ç°è¿™ä¸ªåŠŸèƒ½ä¸»è¦åœ¨äºå¦‚ä½•è·å–åœ¨çº¿ç”¨æˆ·Idï¼Œè€Œæˆ‘ä»¬çŸ¥é“åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦åœ¨çº¿å°±è¦çœ‹çº¿ç¨‹é›†åˆä¸­æœ‰æ²¡æœ‰è¿™ä¸ªç”¨æˆ·Idå¯¹åº”çš„çº¿ç¨‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥éå†çº¿ç¨‹é›†åˆæ¥è·å–åœ¨çº¿ç”¨æˆ·çš„Idå¹¶ä¼ ç»™å®¢æˆ·ç«¯</p>
<p><strong>åˆ›å»ºç¾¤èŠ</strong>ï¼šæ‹‰ç¾¤éœ€è¦çŸ¥é“ç¾¤èŠåã€åœ¨çº¿ç”¨æˆ·éƒ½æœ‰è°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªç¾¤çš„ç¾¤æˆå‘˜æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå†å°†ç¾¤èŠæ”¾å…¥ä¸€ä¸ªHashMapä¸­é›†ä¸­ç®¡ç†ï¼Œkeyä¸ºç¾¤èŠåï¼Œvalueä¸ºç”¨æˆ·é˜Ÿåˆ—</p>
<p><strong>ç¾¤èŠ</strong>ï¼šè·Ÿç§èŠçš„é€»è¾‘å®ç°å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™ä¸ªè¦å‘ç»™å¥½å‡ ä¸ªäººï¼Œå°±è¦åœ¨è¦å‘çš„ç¾¤èŠçš„ç”¨æˆ·é˜Ÿåˆ—ä¸­éå†ç”¨æˆ·æ¥ä¼ ä¿¡æ¯</p>
<p><strong>æ–‡ä»¶å‘é€</strong>ï¼šè·Ÿç§èŠï¼Œç¾¤èŠå¾ˆç›¸ä¼¼ï¼Œå”¯ä¸€ä¸åŒå°±æ˜¯è¦ä½¿ç”¨Fileçš„IOæµæ¥ä¼ æ–‡ä»¶</p>
<p><strong>æœåŠ¡ç«¯æ–°é—»æ¨é€</strong>ï¼šä¸»è¦è¿˜æ˜¯éå†ï¼Œéå†æ¯ä¸ªåœ¨çº¿å®¢æˆ·ç«¯ï¼Œç»™å®ƒä»¬å‘æ¶ˆæ¯ï¼Œå¹¶ä¸”ç”¨whileå¾ªç¯ä¸æ–­è¯»å–éœ€è¦å‘é€çš„æ¶ˆæ¯</p>
<p><strong>æ— å¼‚å¸¸é€€å‡º</strong>ï¼šè¿™ä¸ªéœ€è¦åœ¨ç”¨æˆ·æƒ³è¦é€€å‡ºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä»ç®¡ç†çº¿ç¨‹çš„é›†åˆä¸­ç§»é™¤è¯¥ç”¨æˆ·çº¿ç¨‹</p>
<p><strong>åç«¯æ¨¡å—å·²åŸºæœ¬å®Œæˆï¼Œç°åœ¨ä½ å°±å¯ä»¥æ‰“å¼€æœåŠ¡ç«¯ï¼Œå¤šå¼€å®¢æˆ·ç«¯æ¥åœ¨æ§åˆ¶å°ä½“éªŒä¸€ä¸‹è‡ªå·±å†™çš„æ— UIèŠå¤©å®¤</strong></p>

      
    </div>
    <footer class="article-footer">
      
      
      
        <div class="share-wrapper">
  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fluminous.blog%2F2025%2F06%2F02%2F%25E5%259F%25BA%25E4%25BA%258Esocket%25E9%2580%259A%25E4%25BF%25A1%25E6%258A%2580%25E6%259C%25AF%25E5%25AE%259E%25E7%258E%25B0%25E7%259A%2584%25E7%25AE%2580%25E5%258D%2595%25E8%2581%258A%25E5%25A4%25A9%25E5%25AE%25A4%2F" target="_blank" rel="noopener noreferrer" title="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
      <div class="share-icon icon icon-facebook">
        
      </div>
    </a>
  
    <a href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fluminous.blog%2F2025%2F06%2F02%2F%25E5%259F%25BA%25E4%25BA%258Esocket%25E9%2580%259A%25E4%25BF%25A1%25E6%258A%2580%25E6%259C%25AF%25E5%25AE%259E%25E7%258E%25B0%25E7%259A%2584%25E7%25AE%2580%25E5%258D%2595%25E8%2581%258A%25E5%25A4%25A9%25E5%25AE%25A4%2F&amp;text=java%3A%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4&amp;via=http%3A%2F%2Fluminous.blog" target="_blank" rel="noopener noreferrer" title="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
      <div class="share-icon icon icon-twitter">
        
      </div>
    </a>
  
    <a href="https://connect.qq.com/widget/shareqq/index.html?url=www.baidu.com&amp;title=java%3A%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4&amp;desc=%F0%9F%A5%A7%E4%BC%A0%E7%BB%9Fsocket%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%A7%81%E8%81%8A%E3%80%81%E7%BE%A4%E8%81%8A%E3%80%81%E6%96%87%E4%BB%B6%E5%8F%91%E9%80%81%E7%AD%89%E5%8A%9F%E8%83%BD%E7%9A%84tiny%E7%89%88QQ&amp;source=http%3A%2F%2Fluminous.blog" target="_blank" rel="noopener noreferrer" title="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
      <div class="share-icon icon icon-qq">
        
      </div>
    </a>
  
    <a href="javascript:;"  title="java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤">
      <div class="share-icon icon icon-weixin">
        
          <div id="share-weixin">
            <div class="share-weixin-dom">
              <div class="share-weixin-content">
                <img id="share-weixin-banner"> 
                <div id="share-weixin-title"></div>
                <div id="share-weixin-desc"></div>
              </div>
              <div class="share-weixin-qrcode">
                <div class="share-weixin-info">
                  <div id="share-weixin-author"></div>
                  <div id="share-weixin-theme">Powered By hexo-theme-reimu</div>
                </div>
                <img id="share-weixin-qr" >
              </div>
            </div>
            <div class="share-weixin-canvas"></div>
          </div>
        
      </div>
    </a>
  
</div>
      
      
      
        <a data-aos="zoom-in" href="/en/2025/06/02/%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4/#comments" class="article-comment-link">
          <span class="post-comments-count waline-comment-count" data-path="/en/2025/06/02/%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4/" itemprop="commentCount"></span>
          Comments
        </a>
      
      
      
      
        <span data-aos="zoom-in" class="article-visitor-link">
          <span class="waline-pageview-count" data-path="/en/2025/06/02/%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4/">0</span>
          <em class="post-meta-item-text">Readings</em>
        </span>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/en/tags/java/" rel="tag" title="java">java</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/en/tags/socket/" rel="tag" title="socket">socket</a></li></ul>


    </footer>
  </div>
  
  <nav id="article-nav" aria-label="Article navigation" data-aos="fade-up">
    
      
      <div class="article-nav-link-wrap left">
        
          <img data-src="http://luminous.blog/covers/cover7.webp" data-sizes="auto" alt="å­¦ä¹ ç¬”è®°â€”â€”ä»é›¶å¼€å§‹é€Ÿé€šæ±‡ç¼–(å››)ï¼šé€»è¾‘è¿ç®—ä¸ç§»ä½æ“ä½œç±»æŒ‡ä»¤ç³»ç»Ÿ" class="lazyload">
        
        <a href="/en/2025/06/17/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%80%9F%E9%80%9A%E6%B1%87%E7%BC%96(%E5%9B%9B)%EF%BC%9A%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E4%B8%8E%E7%A7%BB%E4%BD%8D%E6%93%8D%E4%BD%9C%E7%B1%BB%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F/" aria-label="Prev: å­¦ä¹ ç¬”è®°â€”â€”ä»é›¶å¼€å§‹é€Ÿé€šæ±‡ç¼–(å››)ï¼šé€»è¾‘è¿ç®—ä¸ç§»ä½æ“ä½œç±»æŒ‡ä»¤ç³»ç»Ÿ" title="Prev: å­¦ä¹ ç¬”è®°â€”â€”ä»é›¶å¼€å§‹é€Ÿé€šæ±‡ç¼–(å››)ï¼šé€»è¾‘è¿ç®—ä¸ç§»ä½æ“ä½œç±»æŒ‡ä»¤ç³»ç»Ÿ"></a>
        <div class="article-nav-caption">Prev</div>
        <h3 class="article-nav-title">
          
            å­¦ä¹ ç¬”è®°â€”â€”ä»é›¶å¼€å§‹é€Ÿé€šæ±‡ç¼–(å››)ï¼šé€»è¾‘è¿ç®—ä¸ç§»ä½æ“ä½œç±»æŒ‡ä»¤ç³»ç»Ÿ
          
        </h3>
      </div>
    
    
    
    <div class="article-nav-link-wrap right">
      
        <img data-src="http://luminous.blog/covers/specific/mc1.webp" data-sizes="auto" alt="Minecraftæ¨¡ç»„ç¼–å†™æ•™ç¨‹" class="lazyload">
      
      <a href="/en/2025/01/13/Minecraft%E6%A8%A1%E7%BB%84%E7%BC%96%E5%86%99%E6%95%99%E7%A8%8B/" aria-label="Next: Minecraftæ¨¡ç»„ç¼–å†™æ•™ç¨‹"  title="Next: Minecraftæ¨¡ç»„ç¼–å†™æ•™ç¨‹"></a>
      <div class="article-nav-caption">Next</div>
      <h3 class="article-nav-title">
        
          Minecraftæ¨¡ç»„ç¼–å†™æ•™ç¨‹
        
      </h3>
    </div>
    
  </nav>


</article>









  <section id="comments" data-aos="fade-up">
    <div class="comment-header">
      
      
        
      
      <h2 class="comment-title">Leave a comment</h2>
      <div class="comment-selector">
        <div class="comment-selector-wrap">
            
            <div class="selector-item" data-selector="waline">
              <span>waline</span>
            </div>
            
        </div>
      </div>
    </div>
    <div class="comment-content">
      
        <div class="comment waline-comment" data-aos="fade-up"
          id="waline-comment">
        </div>
      
    </div>
  </section>


</section>
        </div>
        <footer id="footer" aria-label="Site footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      
      
      
        2020-2025
      
      <span class="footer-info-sep rotate"></span>
      Luminous
    </div>
    
      <div>
        Powered by&nbsp;<a href="https://hexo.io/" rel="noopener nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener nofollow noreferrer" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        68.3k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        05:40
      </div>
    
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">Number of visits&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">Number of visitors&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav" aria-label="Mobile navigation">
  <div class="sidebar-wrap">
    
      
        <div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3>
<div class="sidebar-toc-wrapper toc-div-class" >
  
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4"><span class="toc-number">1.</span> <span class="toc-text">[java]åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">å¼•è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socket%E6%A0%B8%E5%BF%83java%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">socketæ ¸å¿ƒjavaç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK%E4%B8%8B%E8%BD%BD%E5%8F%8A%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">JDKä¸‹è½½åŠç¯å¢ƒå˜é‡é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">é¡¹ç›®ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">å¼€å§‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chatcommon"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">chatcommon</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chatmain-chatframe"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">chatmain&#x2F;chatframe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resources"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">resources</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">service</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%8E%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.1.</span> <span class="toc-text">æ³¨å†Œä¸ç™»å½•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%81%E8%81%8A%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.2.</span> <span class="toc-text">ç§èŠåŠŸèƒ½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.5.3.</span> <span class="toc-text">å…¶ä»–åŠŸèƒ½</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
  
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Luminous" class="lazyload">
  <div class="sidebar-author-name">Luminous</div>
  <div class="sidebar-description">åŠ¨æ¼«å®…&amp;æŠ€æœ¯å®…</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Post</div>
    <div class="sidebar-state-number">13</div>
  </div>
  <div class="sidebar-state-category">
    <div>Category</div>
    <div class="sidebar-state-number">8</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tag</div>
    <div class="sidebar-state-number">9</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a href=https://github.com/Torchman005 itemprop="url" target="_blank" aria-label="github" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-youtube sidebar-social-icon">
      <a href=https://www.youtube.com/@LuminousZJ itemprop="url" target="_blank" aria-label="youtube" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/356164519?spm_id_from=333.1007.0.0 itemprop="url" target="_blank" aria-label="bilibili" rel="noopener nofollow noreferrer"></a>
    </div>
  
    <div class="icon-stackoverflow sidebar-social-icon">
      <a href=https://stackoverflow.com/users/30805314/luminous itemprop="url" target="_blank" aria-label="stackoverflow" rel="noopener nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/" aria-label="Home"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf015;
            
          
        </div>
        <div class="sidebar-menu-link">Home</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/archives" aria-label="Archives"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf187;
            
          
        </div>
        <div class="sidebar-menu-link">Archives</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/about" aria-label="About"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf007;
            
          
        </div>
        <div class="sidebar-menu-link">About</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/en/friend" aria-label="Friend"></a>
        <div class="sidebar-menu-icon icon ">
          
            
              &#xf2b5;
            
          
        </div>
        <div class="sidebar-menu-link">Friend</div>
      </div>
    
  
</div>
</div>
      
    
  </div>
  
    
      <div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div>
    
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>





<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>



  
<script src="/js/generator_search.js" defer></script>






  
<script src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js" integrity="sha384-8LyaidD9GPxQQgLJO&#x2F;WRw&#x2F;O2h3BoNq&#x2F;ApI&#x2F;ecpvM6RsrCz2qP2ppBXUKihP4V&#x2F;2d" crossorigin="anonymous"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["var(--red-0)"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>



  
<script src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js" integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE&#x2F;jMSCxD+jAPU55x&#x2F;jj3wlf" crossorigin="anonymous"></script>

  
<script src="/js/pjax.js"></script>









<div id="lazy-script">
  <div>
    
      
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "Luminous",
          title: "java:åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤",
          url: "http://luminous.blog/2025/06/02/%E5%9F%BA%E4%BA%8Esocket%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%AE%80%E5%8D%95%E8%81%8A%E5%A4%A9%E5%AE%A4/",
          excerpt: "",
          description: "ğŸ¥§ä¼ ç»Ÿsocketå®ç°çš„ç§èŠã€ç¾¤èŠã€æ–‡ä»¶å‘é€ç­‰åŠŸèƒ½çš„tinyç‰ˆQQ",
          stripContent: "[java]åŸºäºsocketé€šä¿¡æŠ€æœ¯å®ç°çš„ç®€å•èŠå¤©å®¤å¼•è¨€socketï¼Œä½ ä¹Ÿè®¸æ²¡å¬è¯´è¿‡ï¼Œä½†ä½ ä¸å¯èƒ½æ²¡ç”¨åˆ°è¿‡(é™¤éä½ 21ä¸–çºªä»¥æ¥æ²¡æœ‰æ¥è§¦è¿‡ç”µå­äº§å“)ã€‚å¸¸è§å¦‚QQï¼Œå¾®ä¿¡ï¼Œåªè¦å­˜åœ¨èŠå¤©æ¡†å’Œè¯„è®ºçš„åœ°æ–¹ï¼Œsocketéƒ½å‘æŒ¥ç€å®ƒçš„ä½œç”¨ã€‚æœ¬æ–‡ç« å°†ä¼šåˆ†ä¸‰å¤§æ¨¡å—(socketåç«¯ç¼–ç¨‹ï¼Œæ•°æ®åº“ï¼ŒUIç¼–ç¨‹)ï¼Œå¸¦ä½ DIYä¸€ä¸ªå±äºè‡ªå·±çš„èŠå¤©å®¤ã€‚ æœ¬é¡¹ç›®å·²åœ¨GitHubå¼€æº:                                    Simple-Chat-Room         https://github.",
          date: "Mon Jun 02 2025 18:19:03 GMT+0800",
          updated: "Mon Jun 02 2025 22:00:00 GMT+0800",
          cover: "http://luminous.blog/covers/cover12.webp",
        };
      </script>
       
    
    
      
        
<script src="/js/insert_highlight.js" data-pjax></script>

        
          
<script src="https://npm.webcache.cn/@zumer/snapdom@1.9.9/dist/snapdom.min.js" integrity="sha384-taz9Bq0wPqLsuiB4ix4blTozt&#x2F;y84cjbMX5ZWkfPPjpVBme8M&#x2F;jWopanNBcdH&#x2F;qp" crossorigin="anonymous" defer data-pjax></script>

          
<script src="https://npm.webcache.cn/qrcode@1.5.1/build/qrcode.js" integrity="sha384-VT1EeewTCEXgndcPMQ0PzV+uVFYjxFIjmAA7s5gcMX9t4Dt5TD+OVQIn7NJWIXn7" crossorigin="anonymous" defer data-pjax></script>

        
      
    
    
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
        const initPswp = (gallery, children) => {
          if (_$$(`${gallery} ${children}`).length > 0) {
            new PhotoSwipeLightbox({
              gallery,
              children,
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
        }
        const pswp = () => {
          initPswp('.article-entry', 'a.article-gallery-item');
          initPswp('.article-gallery', 'a.article-gallery-item');
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      
        








<script data-pjax>
  var loadScript = (src, integrity) => {
    const script = document.createElement('script');
    script.src = src;
    if (integrity) script.integrity = integrity;
    script.crossOrigin = 'anonymous';
    return script;
  };

  var commentConfigKeys = ["waline"];
  var commentConfig = {
    
    
    waline: {
      enable: true,
      load: async () => {
        const container = document.querySelector('.waline-comment');
        if (!container) return;
        container.style.display = 'block';

        let walineInit;
        const walineCdn = 'https://cdn.jsdelivr.net/npm/@waline/client@2.15.8/dist/waline.mjs';
        const walineIntegrity = 'sha384-9sbqJjrfGjbkI6/PI4nU/MvBfEmkkPC4YK9I4zBeMIf1CVCZdCMH/KinBEAZII/5';

        const module = await safeImport(walineCdn, walineIntegrity);
        walineInit = module.init;

        window.walineInstance = walineInit({
          el: '.waline-comment',
          serverURL: 'https://blog-waline-9f6kfq9ge-torchmans-projects.vercel.app/',
          lang: document.documentElement.lang || 'en',
          locale: {},
          emoji: ["https://unpkg.com/@waline/emojis@1.2.0/weibo","https://unpkg.com/@waline/emojis@1.2.0/alus","https://unpkg.com/@waline/emojis@1.2.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/qq","https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.2.0/tw-emoji"],
          meta: ["nick","mail","link"],
          requiredMeta: ["nick","mail"],
          wordLimit: JSON.parse('0'),
          comment: true,
          pageSize: JSON.parse('10'),
          dark: 'html[data-theme="dark"]',
          pageview: JSON.parse('true'),
        });
      }
    },
    
    
    
    
  }
  commentConfig.enable = commentConfigKeys.some(key => commentConfig[key].enable);

  var defaultComment = '';
  if (commentConfig.enable) {
    // 1. é¦–å…ˆæ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰ä¿å­˜çš„è¯„è®ºç±»å‹
    var savedCommentType = localStorage.getItem('commentType');
    
    // 2. å¦‚æœlocalStorageä¸­æœ‰å€¼ä¸”å¯¹åº”çš„è¯„è®ºç³»ç»Ÿå¯ç”¨ï¼Œå°±ä½¿ç”¨å®ƒ
    if (savedCommentType) {
      if (commentConfig[savedCommentType]?.enable) {
        defaultComment = savedCommentType;
      }
    }
    
    // 3. å¦‚æœlocalStorageæ— æ•ˆï¼Œæ£€æŸ¥é…ç½®çš„é»˜è®¤è¯„è®ºç³»ç»Ÿ
    if (!defaultComment) {
      var configDefault = 'waline';
      if (commentConfig[configDefault]?.enable) {
        defaultComment = configDefault;
      }
    }
    
    // 4. å¦‚æœå‰ä¸¤é¡¹éƒ½æ— æ•ˆï¼ŒæŒ‰æŒ‡å®šé¡ºåºæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨çš„è¯„è®ºç³»ç»Ÿ
    if (!defaultComment) {
      defaultComment = commentConfigKeys.find(sys => commentConfig[sys].enable) || '';
    }
  }
  function loadComments() {
    if (!commentConfig.enable) return;
    const loadedComments = {
      valine: false,
      waline: false,
      twikoo: false,
      gitalk: false,
      giscus: false
    };

    // éšè—æ‰€æœ‰è¯„è®ºå®¹å™¨
    const hideAllComments = () => {
      const commentContainers = document.querySelectorAll('.comment');
      commentContainers.forEach(container => {
        container.style.display = 'none';
      });
    };

    // æŒ‰éœ€åŠ è½½è¯„è®ºç³»ç»Ÿ
    const loadCommentSystem = (type) => {
      if (loadedComments[type]) {
        // å¦‚æœå·²åŠ è½½ï¼Œåªéœ€æ˜¾ç¤ºå¯¹åº”å®¹å™¨
        document.querySelector(`.${type}-comment`).style.display = 'block';
        return;
      }

      // æ ¹æ®ç±»å‹åŠ è½½å¯¹åº”çš„è„šæœ¬
      commentConfig[type]?.load();
      loadedComments[type] = true;
    };

    // è¯„è®ºç»„ä»¶é€‰æ‹©å™¨
    const changeActiveCommentItems = (item) => {
      const commentItems = document.querySelectorAll('.selector-item');
      for (let i = 0; i < commentItems.length; i++) {
        commentItems[i].classList.remove('active');
      }
      item.classList.add('active');

      // è·å–è¦åŠ è½½çš„è¯„è®ºç³»ç»Ÿç±»å‹
      const commentType = item.getAttribute('data-selector');

      // éšè—æ‰€æœ‰è¯„è®ºç³»ç»Ÿ
      hideAllComments();

      // åŠ è½½é€‰ä¸­çš„è¯„è®ºç³»ç»Ÿ
      loadCommentSystem(commentType);
    };

    const commentInit = () => {
      // è¯„è®ºç»„ä»¶é€‰æ‹©å™¨ç‚¹å‡»äº‹ä»¶
      const commentItems = document.querySelectorAll('.selector-item');
      for (let item of commentItems) {
        item.addEventListener('click', () => {
          // ä¿å­˜é€‰æ‹©å™¨çŠ¶æ€
          const commentType = item.getAttribute('data-selector');
          window.localStorage.setItem('commentType', commentType);
          // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
          changeActiveCommentItems(item);
        });
      }

      // æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½é»˜è®¤è¯„è®ºç³»ç»Ÿ
      if (defaultComment) {
        const defaultSelectorItem = document.querySelector(`[data-selector="${defaultComment}"]`);
        if (!defaultSelectorItem) return;
        defaultSelectorItem.style.display = 'block';
        defaultSelectorItem.classList.add('active');
        loadCommentSystem(defaultComment);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', commentInit);
    } else {
      commentInit();
    }
  };
  loadComments();
</script>

      
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '1.10.0' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>





  
<script src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js" integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL&#x2F;aORyw+5+HZoU6e" crossorigin="anonymous"></script>

  



  
  <script>
    if (window.matchMedia('(max-width: 959px)').matches) {
      const meting = _$('meting-js');
      if (meting) {
        meting.setAttribute('fixed', 'true');
        const aside = meting.parentNode?.parentNode;
        if (aside?.tagName === 'ASIDE') {
          meting.parentNode.removeChild(meting);
          document.body.appendChild(meting);
        }
      }
    }
  </script>
  
<script src="https://npm.webcache.cn/meting@2.0.1/dist/Meting.min.js" integrity="sha384-ASVlpKF80A22OXTK3tfEjZm1EL6uFMKIC4p8+0maanw1S&#x2F;IyB+Y4JG+ZDU7GpKE8" crossorigin="anonymous"></script>




    
  </body>
  </html>

